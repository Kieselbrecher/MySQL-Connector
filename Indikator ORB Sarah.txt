Indikator ORB Test

//@version=6
indicator("Sarahs 3EMA + ORB + Liqui", overlay=true, max_lines_count=500)

// === PIVOT-LINIEN === //
lengthGroupTitle = "LENGTH LEFT / RIGHT"
leftLenH = input.int(title="Pivot High", defval=10, minval=1, inline="Pivot High", group=lengthGroupTitle)
rightLenH = input.int(title="/", defval=10, minval=1, inline="Pivot High", group=lengthGroupTitle)

leftLenL = input.int(title="Pivot Low", defval=10, minval=1, inline="Pivot Low", group=lengthGroupTitle)
rightLenL = input.int(title="/", defval=10, minval=1, inline="Pivot Low", group=lengthGroupTitle)

pivotColor = input.color(color.purple, title="Farbe Pivot-Linien")

ph = ta.pivothigh(leftLenH, rightLenH)
pl = ta.pivotlow(leftLenL, rightLenL)

if not na(ph)
line.new(x1=bar_index - rightLenH, y1=ph, x2=bar_index, y2=ph, color=pivotColor, width=1, style=line.style_solid, extend=extend.none)

if not na(pl)
line.new(x1=bar_index - rightLenL, y1=pl, x2=bar_index, y2=pl, color=pivotColor, width=1, style=line.style_solid, extend=extend.none)


// === ORB TEIL === //
inputMax = input.int(15, title="ORB total time (minutes)")
sess = input.session("1000-1015", title="Session Time")
t = time(timeframe.period, sess)
hide = timeframe.isintraday and timeframe.multiplier <= inputMax

in_session = not na(t)
is_first = in_session and not in_session[1]

var float orb_high = na
var float orb_low = na

if is_first
orb_high := high
orb_low := low
else
orb_high := orb_high
orb_low := orb_low

if high > orb_high and in_session
orb_high := high
if low < orb_low and in_session
orb_low := low

plot(hide ? orb_high : na , style=plot.style_line, color=orb_high[1] != orb_high ? na : color.green, title="ORB High", linewidth=2)
plot(hide ? orb_low : na , style=plot.style_line, color=orb_low[1] != orb_low ? na : color.red, title="ORB Low", linewidth=2)


// === EMA TEIL === //
ema1_length = input.int(21, title="EMA1_Period")
ema2_length = input.int(50, title="EMA2_Period")
ema3_length = input.int(200, title="EMA3_Period")

ema1_color = input.color(color.blue, title="Farbe EMA1")
ema2_color = input.color(color.orange, title="Farbe EMA2")
ema3_color = input.color(color.green, title="Farbe EMA3")

ema1 = ta.ema(close, ema1_length)
ema2 = ta.ema(close, ema2_length)
ema3 = ta.ema(close, ema3_length)

plot(ema1, color=ema1_color, title="EMA 21")
plot(ema2, color=ema2_color, title="EMA 50")
plot(ema3, color=ema3_color, title="EMA 200")